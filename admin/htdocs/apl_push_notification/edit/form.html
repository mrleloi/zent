<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
<!-- timezon -->
<!-- <script src="tzSelect/jquery.tzSelect.js"></script> -->
<a class="adminOperationBtn return-to-list-btn ml-60" href="<?php echo $thisPage->top_path; ?>/apl_push_notification/">
  <img class="ml-22 ico-return" src="<?php echo $thisPage->shared_path; ?>/images/arrow_menu_on.svg" alt="" />
  <span class="ml-15">一覧に戻る</span>
</a>

<div class="h-align v-items-center ml-60 mt-36">
  <div class="form-title-arrow"></div>
  <div class="form-title">お知らせ<?php echo $thisForm->get('FORM_TITLE') ?></div>
</div>

<?php if (!empty($thisForm->_message)) { ?>
  <p class="err"><?php echo($thisForm->_message); ?></p>
<?php } ?>
<?php if (isset($_REQUEST[$thisForm->get('MODIFY_NAME')])) { ?>
  <form name="<?php echo($FTAG_NAME); ?>" action="./?modify" method="POST" enctype="multipart/form-data">
  <?php } ?>
  <?php if (!isset($_REQUEST[$thisForm->get('MODIFY_NAME')])) { ?>
    <form name="<?php echo($FTAG_NAME); ?>" action="./" method="POST" enctype="multipart/form-data">
    <?php } ?>
    <input type="hidden" name="mode" value="<?php echo($mode); ?>" />
    <input type="hidden" name="sid" value="<?php echo($sid); ?>" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script>
      $(document).ready(function() {
        // const monthNames = ["January", "February", "March", "April", "May", "June",
        //   "July", "August", "September", "October", "November", "December"
        // ];
        const monthNames = ["01", "02", "03", "04", "05", "06",
        "07", "08", "09", "10", "11", "12"
        ];
        const hourNames = ["00", "01", "02", "03", "04", "05", "06",
        "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17",
        "18", "19", "20", "21", "22", "23"
        ];
        const minuteNames = ["00", "01", "02", "03", "04", "05", "06",
        "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17",
        "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29",
        "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40",
        "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59"
        ];
        var qntYears = 4;
        var selectYear = $("#year");
        var selectMonth = $("#month");
        var selectDay = $("#day");
        var selectHour = $("#hour");
        var selectMinute = $("#minute");
        var currentYear = new Date().getFullYear();


        for (var y = 0; y < qntYears; y++){
          let date = new Date(currentYear);
          var yearElem = document.createElement("option");
          yearElem.value = currentYear
          yearElem.textContent = currentYear;
          selectYear.append(yearElem);
          currentYear++;
        }

        for (var m = 0; m < 12; m++){
          let monthNum = new Date(2018, m).getMonth()
          let month = monthNames[monthNum];
          var monthElem = document.createElement("option");
          monthElem.value = monthNum;
          monthElem.textContent = month;
          selectMonth.append(monthElem);
        }

        for (var h = 0; h < 24; h++){
          let hour = hourNames[h];
          var hourElem = document.createElement("option");
          hourElem.value = hour;
          hourElem.textContent = hour;
          selectHour.append(hourElem);
        }

        for (var s = 0; s < 60; s++){
          let minute = minuteNames[s];
          var minuteElem = document.createElement("option");
          minuteElem.value = minute;
          minuteElem.textContent = minute;
          selectMinute.append(minuteElem);
        }

        var d = new Date();
        var month = d.getMonth();
        var year = d.getFullYear();
        var day = d.getDate();
        var hour = d.getHours();
        var minute = d.getMinutes();
        if(minute<10){
          minute= "0"+minute;
        }
        if(hour<10){
          hour= "0"+hour;
        }

        // selectYear.val(year);
        // selectYear.on("change", AdjustDays);
        selectMonth.val(month);
        selectMonth.on("change", AdjustDays);
        selectHour.val(hour);
        //selectHour.on("change", AdjustDays);
        selectMinute.val(minute);
        //selectMinute.on("change", AdjustDays);

        AdjustDays();

        if(year != 0){
          var month1 = '<?php if (strlen($thisForm->_v[4]) > 5){ echo substr($thisForm->_v[4],5,1).(substr($thisForm->_v[4],6,1) - 1); } else { echo $thisForm->_v[6]; }?>';
          //var month2 = '<?php echo strlen($thisForm->getv(3)); ?>';
          //alert(month1);
          if(month1 != "") {
            month = month1;
            //selectMonth.val(month);
            document.getElementById("month").selectedIndex = month;
          }
          var day1 = '<?php if (strlen($thisForm->_v[4]) > 5){ echo substr($thisForm->_v[4],8,1).(substr($thisForm->_v[4],9,1)); } else { echo $thisForm->_v[7]; }?>';
          //alert(day1);
          if(day1 != "") {
            day = day1;
            selectDay.val(day);
          }
          var hour1 = '<?php if (strlen($thisForm->_v[4]) > 5){ echo substr($thisForm->_v[4],11,2); } else { echo $thisForm->_v[8]; }?>';
          if(hour1 != "") {
            hour = hour1;
            selectHour.val(hour);
          }
          var minute1 = '<?php if (strlen($thisForm->_v[4]) > 5){ echo substr($thisForm->_v[4],14,2); }else{ echo $thisForm->_v[9]; }?>';
          if(minute1 != "") {
            minute = minute1;
            selectMinute.val(minute);
          }
        } else {
          selectDay.val(day)
        }
        function AdjustDays(){
          var year = selectYear.val();
          var year1 = '<?php echo substr($thisForm->_v[4],0,4)?>';
          if(year1 != "") {
            year = year1;
            selectYear.val(year);
          }

          if(year == 0){
            document.getElementById("month").setAttribute("disabled", "disabled");
            document.getElementById("day").setAttribute("disabled", "disabled");
            document.getElementById("hour").setAttribute("disabled", "disabled");
            document.getElementById("minute").setAttribute("disabled", "disabled");
          } else {
            document.getElementById("month").removeAttribute("disabled");
            document.getElementById("day").removeAttribute("disabled");
            document.getElementById("hour").removeAttribute("disabled");
            document.getElementById("minute").removeAttribute("disabled");
          }

          var month = parseInt(selectMonth.val()) + 1;
          selectDay.empty();

          //get the last day, so the number of days in that month
          var days = new Date(year, month, 0).getDate();

          //lets create the days of that month
          for (var d = 1; d <= days; d++){
            var dayElem = document.createElement("option");
            if(d < 10){
              d= "0"+d;
            }
            dayElem.value = d;
            dayElem.textContent = d;
            selectDay.append(dayElem);
          }

        }

      });
    </script>

    <div class="item-container mt-34 promomaterial">
      <!-- タイトル -->
      <?php $k = 1; if (!empty($afconf[$k])) { ?>
        <div class="item-row">
          <div class="name-container">
            <div class="name no-supplement" id="err<?php echo($k); ?>"><?php echo($afconf[$k]['title']); ?></div>
            <?php if (needv($k)) { ?>
              <div class="required">※必須</div>
            <?php } ?>
            <div class="colon">：</div>
          </div>
          <div>
            <?php foreach($_push_notification->_device_type as $key => $val){ ?>
                <input type="radio" name="af:<?php echo needv($k)?>:<?php echo $k?>" id="form<?php echo $k; ?>-<?php echo $key; ?>" <?php echo cbv($k, $key);?>/>
                <label for="form<?php echo $k; ?>-<?php echo $key; ?>" class="radio"><?php echo $val; ?></label>
            <?php } ?>
            <!-- <?php if ($key==5) {?>
            $name = "af:<?php echo(needv($k)); ?>:<?php echo($k); ?>";
          <?php }else {?>
          $name = "af:<?php echo($k); ?>";
          <?php}?> -->
          <!-- <?php } ?> -->
          <input
          id="a"
          type="text"
          style="display: none"
          name="af::<?php echo $k+9; ?>"
          value="<?php echo($thisForm->getv($k+9)); ?>"
          class="input"
          autocomplete="off"
          />
        </div>
      </div>

    <?php } ?>
    <!-- タイトル -->
    <?php $k = 2; if (!empty($afconf[$k])) { ?>
      <div class="item-row">
        <!-- <div class="col-25"> -->
        <div class="name-container">
          <div class="name no-supplement" id="err<?php echo($k); ?>"><?php echo($afconf[$k]['title']); ?></div>
          <?php if (needv($k)) { ?>
            <div class="required">※必須</div>
          <?php } ?>
          <div class="colon">：</div>
        </div>
        <!-- </div> -->
        <!-- <div class="col-75"> -->
        <input
        type="text"
        name="af:<?php echo(needv($k)); ?>:<?php echo($k); ?>"
        value="<?php echo($thisForm->getv($k)); ?>"
        class="err-i<?php echo($thisForm->getm($k)); ?> input"
        autocomplete="off"
        />
        <!-- </div> -->
      </div>
    <?php } ?>
    <!-- ボディー -->
    <?php $k = 3; if (!empty($afconf[$k])) { ?>
      <div class="item-row">
        <!-- <div class="col-25"> -->
        <div class="name-container">
          <div class="name no-supplement" id="err<?php echo($k); ?>"><?php echo($afconf[$k]['title']); ?></div>
          <?php if (needv($k)) { ?>
            <div class="required">※必須</div>
          <?php } ?>
          <div class="colon">：</div>
        </div>
        <!-- </div> -->
        <!-- <div class="col-75"> -->
        <textarea wrap="hard" style="width:600px;" name="af:<?php echo needv($k)?>:<?php echo $k?>" class="err-i<?php echo $thisForm->getm($k)?> textarea ml-15"><?php echo $thisForm->getv($k)?></textarea>
        <!-- </div> -->
      </div>
    <?php } ?>
    <?php $k = 4; if (!empty($afconf[$k])) { ?>
      <div class="item-row">
        <!-- <div class="col-25"> -->
        <div class="name-container">
          <div class="name no-supplement" id="err<?php echo($k); ?>"><?php echo($afconf[$k]['title']); ?></div>
          <?php if (needv($k)) { ?>
            <div class="required">※必須</div>
          <?php } ?>
          <div class="colon">：</div>
        </div>
        <!-- </div> -->
        <!-- <div class="col-75"> -->
        <div class="ml-15">
          <select id="year" style="word-wrap:break-word;width:20%;" name="af:<?php echo needv($k)?>:<?php echo $k?>" class="form<?php echo $k; ?>-<?php echo $key; ?>">
            <option <?php echo pdv($k,0); ?> <?php echo("selected");?>>即時投稿</option>
          </select>
          <label for="year">年</label>
          <select id="month" style="word-wrap:break-word;width:13%;" name="af::<?php echo $k+2; ?>" class="form<?php echo $k+1; ?>-<?php echo $key; ?>">
            <!-- <?php if (isset($_REQUEST[$thisForm->get('MODIFY_NAME')])) { ?>
            <option <?php if($selected == '2020'){echo("selected");}?>><?php echo date("F", strtotime(07));?></option>
          <?php } ?> -->
        </select>
        <label for="month">月</label>
        <select id="day" style="word-wrap:break-word;width:13%;" name="af::<?php echo $k+3; ?>" class="form<?php echo $k+2; ?>-<?php echo $key; ?>"></select>
        <label for="day">日</label>
        <select id="hour" style="word-wrap:break-word;width:13%;" name="af::<?php echo $k+4; ?>" class="form<?php echo $k+3; ?>-<?php echo $key; ?>"></select>
        <label for="hour">時</label>
        <select id="minute" style="word-wrap:break-word;width:13%;" name="af::<?php echo $k+5; ?>" class="form<?php echo $k+4; ?>-<?php echo $key; ?>"></select>
        <label for="minute">分</label>
        <!-- </div> -->
      </div>
    </div>
  <?php } ?>
  <!-- ステータス -->
  <?php $k = 5; if (!empty($afconf[$k])) { ?>
    <div class="item-row">
      <div class="name-container">
        <div class="name no-supplement" id="err<?php echo($k); ?>"><?php echo($afconf[$k]['title']); ?></div>
        <?php if (needv($k)) { ?>
          <div class="required">※必須</div>
        <?php } ?>
        <div class="colon">：</div>
      </div>
      <?php foreach($_push_notification->_cstatus as $key => $val){ ?>
        <input type="radio" name="af:<?php echo needv($k)?>:<?php echo $k?>" id="form<?php echo $k; ?>-<?php echo $key; ?>" <?php echo cbv($k, $key);?>/>
        <label for="form<?php echo $k; ?>-<?php echo $key; ?>" class="radio"><?php echo $val; ?></label>
      <?php } ?>
    </div>

  <?php } ?>
  <!-- 確認ボタン -->
  <div class="a-center pt-80 pb-62">
    <input
    class="confirm-btn"
    type="submit"
    name="<?php echo($thisForm->get('CONFIRM_NAME')); ?>"
    value="<?php echo($thisForm->get('CONFIRM_TITLE')); ?>"
    onclick="removeFileinput()"
    />
  </div>
</div>
</form>

<?php include('caution.html'); ?>

<!-- <script type="text/javascript">
$(document).ready(function() {
$(".fancybox").fancybox();
});
</script> -->

<script type="text/javascript">
  //  function hide(x) {
  //    alert(x);
  //   if (x.checked) {
  //     document.getElementById("a").style.display = "block";
  //     // document.getElementById("A").style.visibility = "visible";
  //   }
  // }
  $("input[name='af:x:1']").change(function() {
    var value = $(this).val();
    if(value == 5 || value == 6){
      document.getElementById("a").style.display = "block";
      document.getElementById("a").required = true;
    } else {
      document.getElementById("a").style.display = "none";
      document.getElementById("a").required = false;
    }
  });
  document.getElementById("year").onchange = function () {
    document.getElementById("month").setAttribute("disabled", "disabled");
    document.getElementById("day").setAttribute("disabled", "disabled");
    document.getElementById("hour").setAttribute("disabled", "disabled");
    document.getElementById("minute").setAttribute("disabled", "disabled");
    //alert("Tài liệu học Lập Trình Web"+this.value);
    if (this.value != 0)
    {
      document.getElementById("month").removeAttribute("disabled");
      document.getElementById("day").removeAttribute("disabled");
      document.getElementById("hour").removeAttribute("disabled");
      document.getElementById("minute").removeAttribute("disabled");
    }
    // if (this.value == '即時投稿')
    //   document.getElementById("month").setAttribute("disabled", "disabled");
    // }
  };
  //   $(document).ready(function(){
  //
  // 	$('select.makeMeFancy').tzSelect({
  // 		render : function(option){
  // 			return $('<li>',{
  // 				html:	'<img src="'+option.data('icon')+'" width="40px"/><span>'+
  // 						option.data('html-text')+'</span>'
  // 			});
  // 		},
  // 		className : 'hasDetails'
  // 	});
  //
  // });
  function StarttimeControl(){
    var type='disabled';
    var nm=new Array('startMonth:x:111','startDay:x:112','startHour:x:113','startMin:x:114');
    var flagnm='startYear:x:110';
    var flagval=false;
    var flag_true=true;
    var flag_false=false;
    var obj = document.getElementsByName(flagnm);
    var imax=obj.length;
    for(i=0; i<imax; i++) {
      if(obj[i].value==flagval){
        chgStyle_name(type,nm,flag_true);
      }else{
        chgStyle_name(type,nm,flag_false);
      }
    }
    return false;
  }
  //   function ShowLength(str,id,len) {
  // 	strlen = str.length;
  // 	if (strlen > len) {
  // 		strlen = len;
  // 	}
  // 	document.getElementById(id).innerHTML = strlen + "/" + len + "文字";
  // }
  // ShowLength("<?php echo $thisForm->getv(4)?>", 'inputlength', 40);
  function removeFileinput(){
    //alert('<%=$FTAG_NAME%>');
    // $mode = $_util->RequestVal('mode','abc');
    // ret = confirm("Yahoo!Japanへ飛びます。宜しいですか？"+$mode);
    // if (ret == true){
    //   location.href = "http://www.yahoo.co.jp/";
    // }
    // $mode＝"123"
    var frm=document.getElementsByName('<%=$FTAG_NAME%>');
    var inputs=frm[0].getElementsByTagName("input");
    for( var i = 0; i < inputs.length; i++ ) {
      if(inputs.item(i).type=='file'){
        if(inputs.item(i).value.length < 1){
          inputs.item(i).parentNode.removeChild(inputs.item(i));
        }
      }
    }

  }

</script>
